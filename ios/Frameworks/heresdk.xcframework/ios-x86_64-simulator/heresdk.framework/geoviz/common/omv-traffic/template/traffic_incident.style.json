{
    "styles": [
        {
            "id": "traffic_incident_icon",
            "styleSet": "incident_icons",
            "when": ["!", ["get", "is_primary"]],
            "technique": "icon",
            "category": ["concat", "traffic-icon-", ["get", "kind"]],
            "minZoomLevel": ["match", ["get", "kind"],
                "road_closure", ["ref", "TrafficStyle.Incident.RoadClosure.Opacity"],
                "accident", ["ref", "TrafficStyle.Incident.Accident.Opacity"],
                "congestion", ["ref", "TrafficStyle.Incident.Congestion.Opacity"],
                "construction", ["ref", "TrafficStyle.Incident.Construction.Opacity"],
                "disabled_vehicle", ["ref", "TrafficStyle.Incident.DisabledVehicle.Opacity"],
                "mass_transit", ["ref", "TrafficStyle.Incident.MassTransit.Opacity"],
                "planned_event", ["ref", "TrafficStyle.Incident.PlannedEvent.Opacity"],
                "road_hazard", ["ref", "TrafficStyle.Incident.RoadHazard.Opacity"],
                "weather", ["ref", "TrafficStyle.Incident.Weather.Opacity"],
                "other", ["ref", "TrafficStyle.Incident.Other.Opacity"],
                null],
            "attr": {
                "placements": "T",
                "perspective-scale-min": ["ref", "Icon.SmoothScaling.Min"],
                "world-line-offset": [
                    "case",
                    ["all", ["ref", "Traffic.StreetCategory4"], ["ref", "Traffic.Ramp"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.RampOffset"]],
                    ["ref", "Traffic.StreetCategory4"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.Offset"]],
                    ["all", ["ref", "Traffic.StreetCategory3"], ["ref", "Traffic.Ramp"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.RampOffset"]],
                    ["ref", "Traffic.StreetCategory3"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.Offset"]],
                    ["all", ["ref", "Traffic.StreetCategory2"], ["ref", "Traffic.Ramp"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.RampOffset"]],
                    ["ref", "Traffic.StreetCategory2"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.Offset"]],
                    ["all", ["ref", "Traffic.StreetCategory1"], ["ref", "Traffic.Ramp"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.RampOffset"]],
                    ["ref", "Traffic.StreetCategory1"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.Offset"]],
                    ["all", ["ref", "Traffic.StreetCategory0"], ["ref", "Traffic.Ramp"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.RampOffset"]],
                    ["all", ["ref", "Traffic.StreetCategory0"]],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.Offset"]],
                    null
                ],
                "far-threshold-range": 0.015,
                "fade-time": 0.3,
                "perspective-scale-max": ["ref", "Icon.SmoothScaling.Max"],
                "replaceable": true,
                "new-label-spread-frames": 10,
                "shadow-size-increment": ["ref", "IconShadow.SizeIncrement"],
                "width": [
                    "case",
                    ["ref", "Traffic.StreetCategory0"],
                    ["step", ["ref", "TrafficStyle.NoRoute.Category0.Width"],
                        0,
                        1, ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]],
                    ["ref", "Traffic.StreetCategory1"],
                    ["step", ["ref", "TrafficStyle.NoRoute.Category1.Width"],
                        0,
                        1, ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]],
                    ["ref", "Traffic.StreetCategory2"],
                    ["step", ["ref", "TrafficStyle.NoRoute.Category2.Width"],
                        0,
                        1, ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]],
                    ["ref", "Traffic.StreetCategory3"],
                    ["step", ["ref", "TrafficStyle.NoRoute.Category3.Width"],
                        0,
                        1, ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]],
                    ["ref", "Traffic.StreetCategory4"],
                    ["step", ["ref", "TrafficStyle.NoRoute.Category4.Width"],
                        0,
                        1, ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]],
                    ["ppi-scale", ["ref", "TrafficStyle.NoRoute.IconSize"], ["ref", "ScalePpi.labels"]]
                ],
                "shadow-dx": ["ref", "IconShadow.Distance.X"],
                "shadow-color": ["ref", "IconShadow.Color"],
                "shadow-shear-factor-y": ["ref", "IconShadow.ShearFactor.Y"],
                "far-threshold": 0.9,
                "shadow-enabled": ["ref", "IconShadow.Enabled.Traffic"],
                "brightness": ["ref", "Icon.Traffic.Brightness"],
                "shadow-dy": ["-", ["ref", "IconShadow.Distance.Y"]],
                "shadow-blur-radius": ["ref", "IconShadow.BlurRadius"],
                "shadow-shear-factor-x": ["ref", "IconShadow.ShearFactor.X"],
                "image": ["concat", ["ref", "tmcIconLookup"], ".svg"]
            }
        },
        {
            "id": "traffic_incident_outline",
            "styleSet": "traffic_incidents",
            "technique": "line",
            "description": "outline",
            "category": ["match", ["get", "kind"],
                "road_closure", "traffic-incidents-closure-outline",
                "traffic-incidents-outline"],
            "minZoomLevel": ["match", ["get", "kind"],
                "road_closure", ["ref", "TrafficStyle.Incident.RoadClosure.Opacity"],
                "accident", ["ref", "TrafficStyle.Incident.Accident.Opacity"],
                "congestion", ["ref", "TrafficStyle.Incident.Congestion.Opacity"],
                "construction", ["ref", "TrafficStyle.Incident.Construction.Opacity"],
                "disabled_vehicle", ["ref", "TrafficStyle.Incident.DisabledVehicle.Opacity"],
                "mass_transit", ["ref", "TrafficStyle.Incident.MassTransit.Opacity"],
                "planned_event", ["ref", "TrafficStyle.Incident.PlannedEvent.Opacity"],
                "road_hazard", ["ref", "TrafficStyle.Incident.RoadHazard.Opacity"],
                "weather", ["ref", "TrafficStyle.Incident.Weather.Opacity"],
                "other", ["ref", "TrafficStyle.Incident.Other.Opacity"],
                null],
            "attr": {
                "offset": [
                    "*",
                    ["ref", "TrafficOffsetDirection"],
                    [
                        "case",
                        ["all", ["ref", "Traffic.StreetCategory4"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.RampOffset"]],
                        ["ref", "Traffic.StreetCategory4"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory3"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.RampOffset"]],
                        ["ref", "Traffic.StreetCategory3"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory2"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.RampOffset"]],
                        ["ref", "Traffic.StreetCategory2"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory1"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.RampOffset"]],
                        ["ref", "Traffic.StreetCategory1"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory0"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.RampOffset"]],
                        ["all", ["ref", "Traffic.StreetCategory0"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.Offset"]],
                        null
                    ]
                ],
                "width": [
                    "case",
                    ["ref", "Traffic.StreetCategory4"],
                    [
                        "world-ppi-scale",
                        [
                            "+",
                            ["*", 2, ["ref", "TrafficStyle.NoRoute.Category4.OutlineWidth"]],
                            ["ref", "TrafficStyle.NoRoute.Category4.Width"]
                        ]
                    ],
                    ["ref", "Traffic.StreetCategory3"],
                    [
                        "world-ppi-scale",
                        [
                            "+",
                            ["*", 2, ["ref", "TrafficStyle.NoRoute.Category3.OutlineWidth"]],
                            ["ref", "TrafficStyle.NoRoute.Category3.Width"]
                        ]
                    ],
                    ["ref", "Traffic.StreetCategory2"],
                    [
                        "world-ppi-scale",
                        [
                            "+",
                            ["*", 2, ["ref", "TrafficStyle.NoRoute.Category2.OutlineWidth"]],
                            ["ref", "TrafficStyle.NoRoute.Category2.Width"]
                        ]
                    ],
                    ["ref", "Traffic.StreetCategory1"],
                    [
                        "world-ppi-scale",
                        [
                            "+",
                            ["*", 2, ["ref", "TrafficStyle.NoRoute.Category1.OutlineWidth"]],
                            ["ref", "TrafficStyle.NoRoute.Category1.Width"]
                        ]
                    ],
                    ["ref", "Traffic.StreetCategory0"],
                    [
                        "world-ppi-scale",
                        [
                            "+",
                            ["*", 2, ["ref", "TrafficStyle.NoRoute.Category0.OutlineWidth"]],
                            ["ref", "TrafficStyle.NoRoute.Category0.Width"]
                        ]
                    ],
                    null
                ],
                "color": ["match", ["get", "kind"],
                    "road_closure", ["ref", "TrafficStyle.NoRoute.BlockingOutlineColor"],
                    ["ref", "TrafficStyle.NoRoute.IncidentOutlineColor"]]
            }
        },
        {
            "id": "traffic_incident_line",
            "styleSet": "traffic_incidents",
            "technique": "line",
            "category": ["match", ["get", "kind"],
                "road_closure", "traffic-incidents-closure",
                "traffic-incidents"],
            "minZoomLevel": ["match", ["get", "kind"],
                "road_closure", ["ref", "TrafficStyle.Incident.RoadClosure.Opacity"],
                "accident", ["ref", "TrafficStyle.Incident.Accident.Opacity"],
                "congestion", ["ref", "TrafficStyle.Incident.Congestion.Opacity"],
                "construction", ["ref", "TrafficStyle.Incident.Construction.Opacity"],
                "disabled_vehicle", ["ref", "TrafficStyle.Incident.DisabledVehicle.Opacity"],
                "mass_transit", ["ref", "TrafficStyle.Incident.MassTransit.Opacity"],
                "planned_event", ["ref", "TrafficStyle.Incident.PlannedEvent.Opacity"],
                "road_hazard", ["ref", "TrafficStyle.Incident.RoadHazard.Opacity"],
                "weather", ["ref", "TrafficStyle.Incident.Weather.Opacity"],
                "other", ["ref", "TrafficStyle.Incident.Other.Opacity"],
                null],
            "attr": {
                "offset": [
                    "*",
                    ["ref", "TrafficOffsetDirection"],
                    [
                        "case",
                        ["all", ["ref", "Traffic.StreetCategory4"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.RampOffset"]],
                        ["ref", "Traffic.StreetCategory4"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory3"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.RampOffset"]],
                        ["all", ["ref", "Traffic.StreetCategory3"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory2"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.RampOffset"]],
                        ["all", ["ref", "Traffic.StreetCategory2"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory1"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.RampOffset"]],
                        ["ref", "Traffic.StreetCategory1"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.Offset"]],
                        ["all", ["ref", "Traffic.StreetCategory0"], ["ref", "Traffic.Ramp"]],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.RampOffset"]],
                        ["ref", "Traffic.StreetCategory0"],
                        ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.Offset"]],
                        null
                    ]
                ],
                "width": [
                    "case",
                    ["ref", "Traffic.StreetCategory4"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category4.Width"]],
                    ["ref", "Traffic.StreetCategory3"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category3.Width"]],
                    ["ref", "Traffic.StreetCategory2"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category2.Width"]],
                    ["ref", "Traffic.StreetCategory1"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category1.Width"]],
                    ["ref", "Traffic.StreetCategory0"],
                    ["world-ppi-scale", ["ref", "TrafficStyle.NoRoute.Category0.Width"]],
                    null
                ],
                "cap": "butt",
                "dasharray": ["match", ["get", "kind"],
                    "road_closure", [
                        "make-vector",
                        ["world-discrete-ppi-scale", ["ref", "TrafficStyle.NoRoute.Incident.DashLength"]],
                        ["world-discrete-ppi-scale", ["ref", "TrafficStyle.NoRoute.Incident.GapLength"]],
                        0,
                        0
                    ],
                    [
                        "make-vector",
                        ["world-discrete-ppi-scale", ["ref", "TrafficStyle.NoRoute.Incident.GapLength"]],
                        ["world-discrete-ppi-scale", ["ref", "TrafficStyle.NoRoute.Incident.DashLength"]],
                        0,
                        0
                    ]],
                "fillcolor": ["match", ["get", "kind"],
                    "road_closure", ["ref", "TrafficStyle.NoRoute.BlockingSecondColor"],
                    "#00000000"],
                "color": ["match", ["get", "kind"],
                    "road_closure", ["ref", "TrafficStyle.NoRoute.BlockingColor"],
                    ["ref", "TrafficStyle.NoRoute.IncidentColor"]]
            }
        }
    ]
}